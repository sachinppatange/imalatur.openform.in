# IMA Latur Runathon 2026 — सुझवलेली अपडेटेड फाईल रचना

खाली दोन पर्याय दिले आहेत — 1) Full-featured (सर्व सुविधा) आणि 2) Simplified (सोपे, कमी फाईल्स).  
तुम्हाला फक्त फाईल-स्ट्रक्चर हवे होते, म्हणून येथे फक्त फाईल/डायरेक्टरी नामे आणि प्रत्येक फाईलची छोटी नोंद (New / Modified / Existing) दिली आहे.

---

## 1) Full-featured (Recommended)
नोट:
- नवीन "registrations" टेबल लागेल (SQL migration दिले आहे).
- Razorpay एकत्रिकरण साठी config + helper फाईल्स.
- Registration-specific repository आणि admin पृष्ठे (Paid / Unpaid वेगळे).
- User साईनअप/register यामध्ये पूर्ण रजिस्ट्रेशन फॉर्म, पेमेंट स्टेप आणि ऑटो-लॉगिन.

Project root
- config/
  - app_config.php (Modified)         # global config (APP_DEBUG, OTP, इत्यादी) — छोटे बदल अपेक्षित (SITE_NAME, RECEIPT settings)
  - wa_config.php (Existing)          # WhatsApp config (unchanged)
  - razorpay_config.php (New)         # Razorpay key_id, key_secret, webhook secret, currency
- migrations/
  - 20251130_create_registrations.sql (New)  # CREATE TABLE registrations (...)
- public/ (or project root web files)
  - index.php (Existing)              # landing (unchanged or minor link updates)
- adminpanel/
  - admin_auth.php (Modified)         # ensure admin session helpers (unchanged/minor)
  - admin_dashboard.php (Modified)    # may link to registrations pages
  - admin_login.php (Existing)
  - admin_logout.php (Existing)
  - user_repository.php (Existing)    # existing admin user helpers
  - registration_repository.php (New) # CRUD helpers for registrations (get_all, get_by_id, mark_paid, export etc.)
  - registrations_list.php (New)      # combined view (with filters)
  - registrations_paid.php (New)      # shows only paid registrations
  - registrations_unpaid.php (New)    # shows only unpaid registrations
  - registration_view.php (New)       # view single registration + print receipt button
  - registration_mark_paid.php (New)  # admin action to mark payment received (for offline payments)
  - whatsapp.php (Existing)
  - storage/
    - log/
      - whatsapp.log (Existing)
      - payments.log (New)
- userpanel/
  - auth.php (Existing)
  - dashboard.php (Modified)          # show registration status / link to view ticket
  - login.php (Existing)
  - logout.php (Existing)
  - profile.php (Existing)
  - signup.php (Modified)             # RENAMED / EXTENDED: becomes basic account creation OR keep for account-only. (See note)
  - register.php (New)                # new registration form page (full Runathon form described)
  - registration_confirm.php (New)    # confirm page before redirect to payment (summary)
  - registration_callback.php (New)   # Razorpay sync callback/return (optional)
  - registration_thankyou.php (New)   # after payment success (shows receipt, auto-login)
  - registration_receipt.php (New)    # printable receipt (simple HTML)
  - registration_history.php (New)    # user sees past registrations & status
  - user_repository.php (Existing)
  - registration_repository.php (New) # same repository used by adminpanel (or shared)
  - whatsapp.php (Existing)
  - storage/
    - log/
      - whatsapp.log (Existing)
      - payments.log (New)
- payments/
  - razorpay.php (New)                # helper to create order, verify signature, capture, webhook verify
  - payment_helpers.php (New)         # common payment helpers (formatting, status constants)
- shared/
  - validators.php (New)              # common input validators (email, mobile, dob)
  - utils.php (New)                   # small helpers (format_date, money_format)
- public_assets/ (images/CSS/JS)
  - css/
  - js/
  - img/
- docs/
  - README.md (Modified)              # short developer notes about migrations and env variables
  - RUN_MIGRATION.md (New)            # how to run migrations (SQL or via DB tool)

### DB Migration (migrations/20251130_create_registrations.sql)
- registrations table (columns suggested):
  - id (INT AUTO_INCREMENT PRIMARY KEY)
  - user_phone (VARCHAR) — E.164 (nullable if guest allowed)
  - email (VARCHAR)
  - mobile_local (VARCHAR) — local 10-digit (optional)
  - participant_name (VARCHAR)
  - gender (ENUM or VARCHAR)
  - dob (DATE)
  - address (TEXT)
  - area (VARCHAR)
  - city (VARCHAR)
  - state (VARCHAR)
  - country (VARCHAR)
  - tshirt_size (VARCHAR)
  - emergency_name (VARCHAR)
  - emergency_number (VARCHAR)
  - blood_group (VARCHAR)
  - ticket_type (VARCHAR) — e.g., "3 Km (Non-Timed) - Super early bird"
  - amount_expected (INT)
  - amount_paid (INT)
  - payment_status (ENUM: 'paid','unpaid','pending')
  - payment_provider (VARCHAR) — e.g., 'razorpay'
  - payment_provider_id (VARCHAR) — order_id / payment_id
  - created_at, updated_at, paid_at (DATETIME)
  - receipt_number (VARCHAR) — generated when paid

---

## 2) Simplified (Minimal changes)
जर तुम्हाला जास्त फाईल न वाढवता पटकन करायचे असेल — खालीलप्रमाणे कमी फाईल्स आणि साधे प्रवाह.

Project root (simplified)
- config/
  - app_config.php (Modified)
  - wa_config.php (Existing)
  - razorpay_config.php (New)
- migrations/
  - 20251130_create_registrations.sql (New)
- adminpanel/
  - admin_dashboard.php (Modified)        # add links: Registrations (Paid/Unpaid)
  - registrations.php (New)               # single admin page with tab/filter for paid/unpaid
  - registration_view.php (New)           # view + mark paid
  - registration_repository.php (New)     # minimal CRUD
- userpanel/
  - signup.php (Modified)                 # extend signup page to include registration form OR add a direct link
  - register.php (New)                    # single page: form -> create registration -> create Razorpay order -> redirect
  - registration_thankyou.php (New)       # show status, allow download receipt (if paid)
  - registration_repository.php (New)     # minimal
- payments/
  - razorpay.php (New)
- storage/logs/
  - payments.log (New)

सोपे प्रवाह (simplified):
- User भरतो register.php → server-side saves registrations (payment_status = 'pending' / 'unpaid') and creates Razorpay order → redirect to Razorpay checkout → on return (success/failure) update payment_status and show thankyou + receipt. User account is created (auth_user session set) on registration submit (auto-login).

---

## काय बदल करावे (उपलब्ध फाईलमधे)
(फक्त रेखाटन — कोड नको म्हणून भरलेले नाही)
- userpanel/signup.php
  - Option A: Keep for account-only signup (no change)
  - Option B: Modify to redirect to new register.php (recommended to keep signup separate and add register.php)
- Add userpanel/register.php (New) — पूर्ण रजिस्ट्रेशन फॉर्म आणि Razorpay order creation
- Add payments/razorpay.php (New) — Razorpay API interactions (create order, verify signature)
- Add shared/ or repo-level registration_repository.php to handle DB reads/writes for registrations
- Add adminpanel pages to list registrations, with filters for paid/unpaid
- Add migration SQL to create registrations table
- Update config to include Razorpay keys and site naming/receipt options

---

## Admin UI विचार
- adminpanel/registrations_paid.php — सूची फक्त ज्या नोंदींना payment_status = 'paid'
- adminpanel/registrations_unpaid.php — payment_status != 'paid' (pending/unpaid)
- adminpanel/registration_view.php — single view, print receipt button, mark as paid (for offline cash)
- Export CSV/Excel option (optional) — could be added as adminpanel/registrations_export.php

---

## Receipt / Printing
- registration_receipt.php — simple printable HTML receipt which accepts registration id and shows receipt fields. Admin and user can open/print.
- receipt numbering — generate receipt_number on paid event (e.g., IMA2026-000123)

---

## Logging & Webhooks
- payments.log — log payment events & webhooks
- Optionally implement Razorpay webhook endpoint to receive asynchronous payment notifications (update payment_status)

---

## Environment / Deployment notes (to add to README)
- Add environment variables or config keys for:
  - RAZORPAY_KEY_ID
  - RAZORPAY_KEY_SECRET
  - RAZORPAY_WEBHOOK_SECRET
  - SITE_NAME, RECEIPT_PREFIX
- Run migration SQL to create registrations table.

---

जर हे रचना बघून तुम्हाला काढायचे असेल तर मी पुढे दोन गोष्टी करू शकतो:
1) Full-featured साठी फाईल-टप्प्याट (की-फंक्शन्स) आणि DBDDL (SQL) पाठवेन.  
2) किंवा Simplified मार्गाचे step-by-step कामांचे breakdown (कुठे काय minimal बदल करायचे) देईन.

काय पसंत आहे — Full-featured की Simplified? किंवा मी थेट अद्ययावत फाईल-लिस्ट (एकदम नेमके path + New/Modified टॅग) एका साध्या टेक्स्ट फाईलमध्ये तयार करु?


























